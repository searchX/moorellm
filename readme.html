<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Welcome to MooreLLM’s documentation! &#8212; MooreLLM  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="_static/basic_mod.css?v=59943e95" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <script src="_static/js/petite-vue.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="moorellm package" href="moorellm.html" />
    <link rel="prev" title="Welcome to MooreLLM’s documentation!" href="index.html" /> 
  </head><body data-dark_mode_code_blocks="true">

<div id="top_nav">
    

    <nav>
        
            
        

        <p id="toggle_sidebar">
            <a href="#" title="Toggle sidebar">|||</a>
        </p>
        <h1><a href="index.html" title="Go to homepage">MooreLLM  documentation</a></h1>

        <a id="mode_toggle" href="#" @click.prevent="handleClick" :title="mode">
    <template v-if="mode == 'light'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_light"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M67.48,18.073c1.913,-1.912 1.913,-5.018 0,-6.931c-1.912,-1.912 -5.018,-1.912 -6.931,0l-6.798,6.799c-1.912,1.912 -1.912,5.018 0,6.931c1.913,1.912 5.018,1.912 6.931,-0l6.798,-6.799Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.728,61.108c1.912,-1.913 1.912,-5.018 -0,-6.931c-1.913,-1.913 -5.019,-1.913 -6.931,-0l-6.799,6.798c-1.912,1.913 -1.912,5.019 0,6.931c1.913,1.913 5.019,1.913 6.931,0l6.799,-6.798Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.682,54.177c-1.913,-1.913 -5.018,-1.913 -6.931,-0c-1.912,1.913 -1.912,5.018 0,6.931l6.798,6.798c1.913,1.913 5.019,1.913 6.931,0c1.913,-1.912 1.913,-5.018 0,-6.931l-6.798,-6.798Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M4.901,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,-0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M18.929,11.142c-1.912,-1.912 -5.018,-1.912 -6.931,0c-1.912,1.913 -1.912,5.019 0,6.931l6.799,6.799c1.912,1.912 5.018,1.912 6.931,-0c1.912,-1.913 1.912,-5.019 -0,-6.931l-6.799,-6.799Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.108,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c-0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c-0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'dark'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_dark"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.901,2.196 -4.901,4.901c0,2.705 2.197,4.901 4.901,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.662,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.989,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.732,61.103c1.91,-1.91 1.91,-5.011 0,-6.921l-0.009,-0.01c-1.91,-1.91 -5.012,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.909,1.91 5.011,1.91 6.92,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.672,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.52,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l-0,-0.01c-0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.901,2.196 -4.901,4.901c0,2.704 2.197,4.9 4.901,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.73,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 -0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.098,34.623c-2.699,0 -4.891,2.192 -4.891,4.892l-0,0.019c-0,2.699 2.192,4.891 4.891,4.891c2.7,0 4.892,-2.192 4.892,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.892,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'darkest'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_darkest"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><path d="M39.315,23.791c8.684,-0 15.734,7.05 15.734,15.733c0,8.684 -7.05,15.734 -15.734,15.734c-8.683,0 -15.733,-7.05 -15.733,-15.734c-0,-8.683 7.05,-15.733 15.733,-15.733Zm0,4.737c6.069,0 10.997,4.927 10.997,10.996c-0,6.069 -4.928,10.996 -10.997,10.996c-6.068,0 -10.996,-4.927 -10.996,-10.996c0,-6.069 4.928,-10.996 10.996,-10.996Z" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.216,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.9,2.196 -4.9,4.901c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.666,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.99,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.737,61.103c1.909,-1.91 1.909,-5.011 -0,-6.921l-0.01,-0.01c-1.91,-1.91 -5.011,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.91,1.91 5.011,1.91 6.921,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.676,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.524,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l0,-0.01c0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.216,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901c-0,2.704 2.196,4.9 4.9,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.734,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.103,34.623c-2.7,0 -4.892,2.192 -4.892,4.892l-0,0.019c-0,2.699 2.192,4.891 4.892,4.891c2.699,0 4.891,-2.192 4.891,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.891,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>
</a>

<script>
(function() {
    const LOCAL_STORAGE_KEY = 'piccoloThemeMode'

    var initialMode = localStorage.getItem(LOCAL_STORAGE_KEY)

    if (initialMode) {
        // Make sure the value in local storage is valid
        if (['light', 'dark', 'darkest'].indexOf(initialMode) == -1) {
            initialMode = 'light'
            localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
        }
    } else {
        // Check if the client prefers dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            initialMode = 'dark'
        } else {
            initialMode = 'light'
        }
        localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
    }

    document.documentElement.dataset.mode = initialMode

    PetiteVue.createApp({
        'mode': initialMode,
        handleClick() {
            let currentMode = this.mode

            if (currentMode == 'light') {
                this.mode = 'dark'
            } else if (currentMode == 'dark') {
                this.mode = 'darkest'
            } else if (currentMode == 'darkest') {
                this.mode = 'light'
            }

            document.documentElement.dataset.mode = this.mode
            localStorage.setItem(LOCAL_STORAGE_KEY, this.mode)

            console.log(this.mode)
        }
    }).mount('#mode_toggle')
})()
</script>
            <p class="mobile_search_link">
                <a href="search.html" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 64" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2">
                        <path d="M14.873 40.009c-2.315-3.943-3.642-8.532-3.642-13.429C11.231 11.91 23.141 0 37.811 0s26.58 11.91 26.58 26.58-11.91 26.58-26.58 26.58a26.44 26.44 0 0 1-14.277-4.161L9.739 62.794a3.12 3.12 0 0 1-4.413 0L.913 58.382c-1.217-1.218-1.217-3.196 0-4.413l13.96-13.96zM37.811 8.054c10.225 0 18.526 8.301 18.526 18.526s-8.301 18.526-18.526 18.526-18.526-8.301-18.526-18.526S27.586 8.054 37.811 8.054z" fill="#fff" />
                    </svg>
                </a>
            </p>
        

        <div class="searchbox_wrapper">
            
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
    </nav>
</div>

    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper"><p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Welcome to MooreLLM’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="moorellm.html">moorellm package</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">examples package</a></li>
</ul>

        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="welcome-to-moorellm-s-documentation">
<h1>Welcome to MooreLLM’s documentation!<a class="headerlink" href="#welcome-to-moorellm-s-documentation" title="Link to this heading">¶</a></h1>
<section id="moorellm-fsm-based-agentic-approach-for-ai-applications">
<h2>MooreLLM - FSM based Agentic Approach for AI Applications<a class="headerlink" href="#moorellm-fsm-based-agentic-approach-for-ai-applications" title="Link to this heading">¶</a></h2>
<p>Welcome to the MooreLLM project! This project is a FSM based approach for creating agentic applications..</p>
<section id="why-moorellm">
<h3>Why MooreLLM?<a class="headerlink" href="#why-moorellm" title="Link to this heading">¶</a></h3>
<p>The current approach (as i have observed) for creating LLM agents are simply <em>giving prompts and some tools</em>, which the LLM can use to generate the desired output. This approach is not very flexible as it may hallucinate or call wrong tools, MooreLLM is an attempt at creating a very controlled LLM agent which has set of states and transitions, and can only perform actions that are allowed in the current state.</p>
</section>
<section id="an-example-to-illustrate-the-need-for-moorellm">
<h3>An example to illustrate the need for MooreLLM<a class="headerlink" href="#an-example-to-illustrate-the-need-for-moorellm" title="Link to this heading">¶</a></h3>
<p>For example, imagine a call-center chatbot, which will converse according to current state, ie if user has just started the chat, the bot will ask for the user’s name, and then greet the user.. then <strong>only when</strong> user has provided the name, the bot will ask for the user’s query.. and so on..</p>
<p>ie the conversation pattern will follow a specific flow, and the bot SHOULD NEVER ask for the query before the user has provided the name.</p>
<section id="the-current-approach-traditional-approach">
<h4>The current approach (Traditional Approach)<a class="headerlink" href="#the-current-approach-traditional-approach" title="Link to this heading">¶</a></h4>
<p>Now imagine a function based approach, where the bot can ask for the name, greet the user, and ask for the query, all at the same time.. this is not a very good approach as the bot can ask for the query even before the user has provided the name.. this can lead to a bad user experience and potentially uncontrolled behavior.</p>
<img src="https://raw.githubusercontent.com/searchX/moorellm/main/images/traditional_approach.png" height="512">
<p>Current approach of mitigating such issues is instructing in system_prompt about the set order/sequence, but this is error prone and not very flexible.</p>
</section>
<section id="what-we-propose-moorellm-approach">
<h4>What we Propose (MooreLLM Approach)<a class="headerlink" href="#what-we-propose-moorellm-approach" title="Link to this heading">¶</a></h4>
<p>Create states for each of the conversation steps, and transitions between them.. this way the bot can only ask for the query when the user has provided the name.. this is a very controlled approach and can lead to a better user experience.</p>
<p>ie now I will have seperate system_prompt for both greeting and asking for the query, so <em>until I am in greet user state, I will only use the system_prompt for greeting, and once I have moved to ask_for_query state, I will only use the system_prompt for asking for the query</em>.</p>
<!-- ![MooreLLM Approach]() -->
<img src="https://raw.githubusercontent.com/searchX/moorellm/main/images/moore_approach.png" height="512">
</section>
</section>
<section id="what-is-an-agentic-ai-application">
<h3>What is an Agentic AI Application?<a class="headerlink" href="#what-is-an-agentic-ai-application" title="Link to this heading">¶</a></h3>
<p>It is an application that can act on its own, without the need for human intervention. It can make decisions, take actions, and interact with the environment.. for example</p>
<ul class="simple">
<li><p>A chatbot that can answer questions</p></li>
<li><p>A robot that can perform tasks</p></li>
<li><p>A game character that can play a game</p></li>
</ul>
</section>
<section id="what-is-an-fsm">
<h3>What is an FSM?<a class="headerlink" href="#what-is-an-fsm" title="Link to this heading">¶</a></h3>
<p>A Finite State Machine (FSM) is a mathematical model of computation. It is a set of states, transitions, and actions. The machine can be in only one state at a time, and it can change from one state to another in response to some inputs. FSMs are widely used in many applications, such as games, control systems, and natural language processing.</p>
<p>example of a FSM:
<img alt="FSM Example" src="https://raw.githubusercontent.com/searchX/moorellm/main/images/01_bulb_state_diagram.png" /></p>
</section>
<section id="how-to-design-an-agentic-ai-application-using-moorellm">
<h3>How to Design an Agentic AI Application using MooreLLM?<a class="headerlink" href="#how-to-design-an-agentic-ai-application-using-moorellm" title="Link to this heading">¶</a></h3>
<p>To use MooreLLM, you need to define the states and transitions! Each state will have base system prompts, and transitions will have the conditions to move from one state to another, for each state you can even parse complex generated output or make use of context variables. (We will see this in the examples)</p>
</section>
<section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h3>
<p>Install the <code class="docutils literal notranslate"><span class="pre">moorellm</span></code> package with <a class="reference external" href="https://pypi.org/project/moorellm">pip</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>moorellm
</pre></div>
</div>
<p>Or install the latest package directly from github</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/searchX/moorellm
</pre></div>
</div>
</section>
<section id="example-usage">
<h3>Example Usage<a class="headerlink" href="#example-usage" title="Link to this heading">¶</a></h3>
<section id="a-light-bulb-chatbot">
<h4>A Light Bulb Chatbot<a class="headerlink" href="#a-light-bulb-chatbot" title="Link to this heading">¶</a></h4>
<p>Create FSM</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openai</span>
<span class="kn">from</span> <span class="nn">moorellm</span> <span class="kn">import</span> <span class="n">MooreFSM</span>
<span class="kn">from</span> <span class="nn">moorellm.models</span> <span class="kn">import</span> <span class="n">MooreRun</span>

<span class="c1"># Create the FSM</span>
<span class="n">fsm</span> <span class="o">=</span> <span class="n">MooreFSM</span><span class="p">(</span><span class="n">initial_state</span><span class="o">=</span><span class="s2">&quot;START&quot;</span><span class="p">)</span>
<span class="n">LIGHT_STATE</span> <span class="o">=</span> <span class="s2">&quot;OFF&quot;</span> <span class="c1"># Default state</span>
</pre></div>
</div>
<p>Define default state <code class="docutils literal notranslate"><span class="pre">START</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the states</span>
<span class="nd">@fsm</span><span class="o">.</span><span class="n">state</span><span class="p">(</span>
    <span class="n">state_key</span><span class="o">=</span><span class="s2">&quot;START&quot;</span><span class="p">,</span>
    <span class="n">system_prompt</span><span class="o">=</span><span class="s2">&quot;You are AI light switcher, Ask user if they want to turn on the light.&quot;</span><span class="p">,</span>
    <span class="n">transitions</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;STATE_ON&quot;</span><span class="p">:</span> <span class="s2">&quot;If user says to turn on the light&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">start_state</span><span class="p">(</span><span class="n">fsm</span><span class="p">:</span> <span class="n">MooreFSM</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">will_transition</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">LIGHT_STATE</span>

    <span class="k">if</span> <span class="n">will_transition</span> <span class="ow">and</span> <span class="n">fsm</span><span class="o">.</span><span class="n">get_next_state</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;STATE_ON&quot;</span><span class="p">:</span>
        <span class="n">LIGHT_STATE</span> <span class="o">=</span> <span class="s2">&quot;ON&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LIGHT TURNED ON&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
<p>Define state <code class="docutils literal notranslate"><span class="pre">STATE_ON</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@fsm</span><span class="o">.</span><span class="n">state</span><span class="p">(</span>
    <span class="n">state_key</span><span class="o">=</span><span class="s2">&quot;STATE_ON&quot;</span><span class="p">,</span>
    <span class="n">system_prompt</span><span class="o">=</span><span class="s2">&quot;Turning on the light...&quot;</span><span class="p">,</span>
    <span class="n">transitions</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;START&quot;</span><span class="p">:</span> <span class="s2">&quot;If user says to turn off the light&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">state_on</span><span class="p">(</span><span class="n">fsm</span><span class="p">:</span> <span class="n">MooreFSM</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">will_transition</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">LIGHT_STATE</span>

    <span class="k">if</span> <span class="n">will_transition</span> <span class="ow">and</span> <span class="n">fsm</span><span class="o">.</span><span class="n">get_next_state</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;START&quot;</span><span class="p">:</span>
        <span class="n">LIGHT_STATE</span> <span class="o">=</span> <span class="s2">&quot;OFF&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LIGHT TURNED OFF&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
<p>Run the FSM</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Create the OpenAI client</span>
    <span class="n">openai_client</span> <span class="o">=</span> <span class="n">openai</span><span class="o">.</span><span class="n">AsyncOpenAI</span><span class="p">()</span>
    <span class="c1"># Simulate conversation</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;You: &quot;</span><span class="p">)</span>
        <span class="n">run_state</span><span class="p">:</span> <span class="n">MooreRun</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fsm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">openai_client</span><span class="p">,</span> <span class="n">user_input</span><span class="o">=</span><span class="n">user_input</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI: </span><span class="si">{</span><span class="n">run_state</span><span class="o">.</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CURRENT LIGHT STATE: &quot;</span><span class="p">,</span> <span class="n">LIGHT_STATE</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>States:</p>
<ul class="simple">
<li><p>START: The initial state where the AI asks the user if they want to turn on the light.</p></li>
<li><p>STATE_ON: The state where the AI turns, only avaliable transition at this state is to turn off the light.</p></li>
</ul>
<p>Notice the transitions, for state <code class="docutils literal notranslate"><span class="pre">start</span></code> we defined only one transition to <code class="docutils literal notranslate"><span class="pre">STATE_ON</span></code>, and for state <code class="docutils literal notranslate"><span class="pre">STATE_ON</span></code> we defined only one transition to <code class="docutils literal notranslate"><span class="pre">START</span></code>, this way the AI can only move from <code class="docutils literal notranslate"><span class="pre">start</span></code> to <code class="docutils literal notranslate"><span class="pre">STATE_ON</span></code> and then from <code class="docutils literal notranslate"><span class="pre">STATE_ON</span></code> to <code class="docutils literal notranslate"><span class="pre">start</span></code> and not any other state.</p>
<p>Note: Default transitions are always available, so if the user input does not match any of the transitions, the AI will move to the same state (ie loop back).</p>
</section>
<section id="user-identification">
<h4>User identification<a class="headerlink" href="#user-identification" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openai</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span> <span class="nn">moorellm</span> <span class="kn">import</span> <span class="n">MooreFSM</span>
<span class="kn">from</span> <span class="nn">moorellm.models</span> <span class="kn">import</span> <span class="n">MooreRun</span>

<span class="c1"># Create the FSM</span>
<span class="n">fsm</span> <span class="o">=</span> <span class="n">MooreFSM</span><span class="p">(</span><span class="n">initial_state</span><span class="o">=</span><span class="s2">&quot;START&quot;</span><span class="p">,</span> <span class="n">end_state</span><span class="o">=</span><span class="s2">&quot;IDENTIFIED&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">UserIdentificationResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">phone_number</span><span class="p">:</span> <span class="nb">str</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@fsm</span><span class="o">.</span><span class="n">state</span><span class="p">(</span>
    <span class="n">state_key</span><span class="o">=</span><span class="s2">&quot;START&quot;</span><span class="p">,</span>
    <span class="n">system_prompt</span><span class="o">=</span><span class="s2">&quot;You are user identification bot, You have to identify the user by asking their name and phone number.&quot;</span><span class="p">,</span>
    <span class="n">response_model</span><span class="o">=</span><span class="n">UserIdentificationResponse</span><span class="p">,</span>
    <span class="n">transitions</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;IDENTIFIED&quot;</span><span class="p">:</span> <span class="s2">&quot;If user provides their name and phone number&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">start_state</span><span class="p">(</span>
    <span class="n">fsm</span><span class="p">:</span> <span class="n">MooreFSM</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">UserIdentificationResponse</span><span class="p">,</span> <span class="n">will_transition</span><span class="p">:</span> <span class="nb">bool</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">will_transition</span> <span class="ow">and</span> <span class="n">fsm</span><span class="o">.</span><span class="n">get_next_state</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;IDENTIFIED&quot;</span><span class="p">:</span>
        <span class="c1"># Set into context</span>
        <span class="n">fsm</span><span class="o">.</span><span class="n">set_context_data</span><span class="p">(</span>
            <span class="s2">&quot;verified_user&quot;</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">user_name</span><span class="p">,</span>
                <span class="s2">&quot;phone_number&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">phone_number</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;Thanks for Identifying yourself.&quot;</span>

    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
</pre></div>
</div>
<p>Call it with</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Create the OpenAI client</span>
    <span class="n">openai_client</span> <span class="o">=</span> <span class="n">openai</span><span class="o">.</span><span class="n">AsyncOpenAI</span><span class="p">()</span>
    <span class="c1"># Simulate conversation</span>
    <span class="k">while</span> <span class="n">fsm</span><span class="o">.</span><span class="n">is_completed</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;You: &quot;</span><span class="p">)</span>
        <span class="n">run_state</span><span class="p">:</span> <span class="n">MooreRun</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fsm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">openai_client</span><span class="p">,</span> <span class="n">user_input</span><span class="o">=</span><span class="n">user_input</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI: </span><span class="si">{</span><span class="n">run_state</span><span class="o">.</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get the context data</span>
    <span class="n">context_data</span> <span class="o">=</span> <span class="n">fsm</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="s2">&quot;verified_user&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User Identified: </span><span class="si">{</span><span class="n">context_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Sample Output</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">You: Hi</span>
<span class="go">AI: Hello there! Could you please provide your name and phone number so I can identify you?</span>
<span class="go">You: My name is Harishankar</span>
<span class="go">AI: Thanks for providing your name. Could you please provide your phone number?</span>
<span class="go">You: My phone number is 1234567890</span>
<span class="go">AI: Thanks for Identifying yourself.</span>
<span class="go">User Identified: {&#39;user_name&#39;: &#39;Harishankar&#39;, &#39;phone_number&#39;: &#39;1234567890&#39;}</span>
</pre></div>
</div>
<p>More examples can be found in the <a class="reference internal" href="examples.html"><span class="doc std std-doc">examples</span></a> directory.</p>
</section>
</section>
<section id="notes">
<h3>Notes<a class="headerlink" href="#notes" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>The MooreLLM is a very basic implementation, and can be extended to support more complex use-cases.</p></li>
<li><p>The FSM is designed to be used with OpenAI’s GPT-4o+ (as it uses structured responses), but can be used with any other model as well (with some modification).</p></li>
<li><p>Possibility of bad return json is non-existent, this is because we are using the latest structured responses from OpenAI, and the MooreLLM is designed to handle only structured responses.</p></li>
</ul>
</section>
<section id="contributing">
<h3>Contributing<a class="headerlink" href="#contributing" title="Link to this heading">¶</a></h3>
<p>MooreLLM at its current state is a very basic implementation, and very opinionated.. I would love to see more contributions and ideas on how to make it more flexible and useful for a wider range of applications, any PRs are welcome!# moorellm</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
    
        <div id="show_right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">&lt;</span><span>Page contents</span></a></p>
        </div>

        <div id="right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">&gt;</span><span>Page contents:</span></a></p>
            <div class="page_toc">
                <ul>
<li><a class="reference internal" href="#">Welcome to MooreLLM’s documentation!</a><ul>
<li><a class="reference internal" href="#moorellm-fsm-based-agentic-approach-for-ai-applications">MooreLLM - FSM based Agentic Approach for AI Applications</a><ul>
<li><a class="reference internal" href="#why-moorellm">Why MooreLLM?</a></li>
<li><a class="reference internal" href="#an-example-to-illustrate-the-need-for-moorellm">An example to illustrate the need for MooreLLM</a><ul>
<li><a class="reference internal" href="#the-current-approach-traditional-approach">The current approach (Traditional Approach)</a></li>
<li><a class="reference internal" href="#what-we-propose-moorellm-approach">What we Propose (MooreLLM Approach)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#what-is-an-agentic-ai-application">What is an Agentic AI Application?</a></li>
<li><a class="reference internal" href="#what-is-an-fsm">What is an FSM?</a></li>
<li><a class="reference internal" href="#how-to-design-an-agentic-ai-application-using-moorellm">How to Design an Agentic AI Application using MooreLLM?</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#example-usage">Example Usage</a><ul>
<li><a class="reference internal" href="#a-light-bulb-chatbot">A Light Bulb Chatbot</a></li>
<li><a class="reference internal" href="#user-identification">User identification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notes">Notes</a></li>
<li><a class="reference internal" href="#contributing">Contributing</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
        </div>
    

      <div class="clearer"></div>
    </div>
    <div class="button_nav_wrapper">
        <div class="button_nav">
            <div class="left">
                
                <a href="index.html">
                    <span class="icon">&lt;</span><span>Welcome to MooreLLM’s documentation!</span></a>
                
            </div>

            <div class="right">
                
                    <a href="moorellm.html"><span>moorellm package</span><span class="icon">&gt;</span></a>
                
            </div>
        </div>
    </div>


    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Harishankar Kumar.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>

<p id="theme_credit">Styled using the <a href="https://github.com/piccolo-orm/piccolo_theme">Piccolo Theme</a></p>
  </body>
</html>